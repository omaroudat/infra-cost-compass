<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIR Management System - Project Documentation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 40px;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 30px;
            margin-bottom: 40px;
        }
        .header h1 {
            color: #0066cc;
            font-size: 2.5em;
            margin: 0;
            font-weight: 300;
        }
        .header .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-top: 10px;
        }
        .toc {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            border-left: 4px solid #0066cc;
        }
        .toc h2 {
            color: #0066cc;
            margin-top: 0;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            margin: 8px 0;
            padding-left: 20px;
        }
        .toc li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        .toc li a:hover {
            color: #0066cc;
        }
        .section {
            margin-bottom: 50px;
            page-break-inside: avoid;
        }
        .section h2 {
            color: #0066cc;
            font-size: 1.8em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        .section h3 {
            color: #495057;
            font-size: 1.4em;
            margin-bottom: 15px;
            margin-top: 30px;
        }
        .section h4 {
            color: #6c757d;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .feature-card h4 {
            color: #28a745;
            margin-top: 0;
        }
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .tech-item {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #bbdefb;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .table th, .table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .table th {
            background: #e9ecef;
            font-weight: 600;
            color: #495057;
        }
        .table tr:nth-child(even) {
            background: #f8f9fa;
        }
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            background: #fff3cd;
        }
        .alert-info {
            border-left-color: #17a2b8;
            background: #d1ecf1;
        }
        .alert-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .workflow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .workflow h3 {
            color: white;
            margin-top: 0;
        }
        .step {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        .step-number {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WIR Management System</h1>
            <div class="subtitle">Comprehensive Project Documentation</div>
            <div style="margin-top: 20px; color: #666;">
                <strong>Version:</strong> 1.0 | 
                <strong>Date:</strong> January 2025 | 
                <strong>Status:</strong> Production Ready
            </div>
        </div>

        <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#executive-summary">1. Executive Summary</a></li>
                <li><a href="#project-overview">2. Project Overview</a></li>
                <li><a href="#system-architecture">3. System Architecture</a></li>
                <li><a href="#features">4. Features & Functionality</a></li>
                <li><a href="#technical-specifications">5. Technical Specifications</a></li>
                <li><a href="#database-schema">6. Database Schema</a></li>
                <li><a href="#user-management">7. User Management & Security</a></li>
                <li><a href="#installation">8. Installation & Setup</a></li>
                <li><a href="#user-guides">9. User Guides</a></li>
                <li><a href="#api-documentation">10. API Documentation</a></li>
                <li><a href="#security">11. Security Considerations</a></li>
                <li><a href="#maintenance">12. Maintenance & Support</a></li>
                <li><a href="#appendices">13. Appendices</a></li>
            </ul>
        </div>

        <div class="section" id="executive-summary">
            <h2>1. Executive Summary</h2>
            
            <h3>Project Purpose</h3>
            <p>The WIR (Work Inspection Report) Management System is a comprehensive web-based platform designed to streamline and automate the management of work inspection reports in construction and infrastructure projects. The system provides end-to-end functionality for creating, managing, tracking, and reporting on work inspection activities.</p>

            <h3>Key Benefits</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Efficiency Improvement</h4>
                    <p>Reduces manual paperwork and processing time by 80% through digital workflows and automation.</p>
                </div>
                <div class="feature-card">
                    <h4>Real-time Tracking</h4>
                    <p>Provides instant visibility into project progress and work inspection status across all stakeholders.</p>
                </div>
                <div class="feature-card">
                    <h4>Compliance & Audit</h4>
                    <p>Ensures regulatory compliance with comprehensive audit trails and documentation standards.</p>
                </div>
                <div class="feature-card">
                    <h4>Cost Reduction</h4>
                    <p>Minimizes project delays and rework through systematic inspection processes and early issue detection.</p>
                </div>
            </div>

            <div class="alert alert-success">
                <strong>Project Status:</strong> Successfully deployed and operational. The system is currently managing work inspection reports for multiple construction projects with full user adoption.
            </div>
        </div>

        <div class="section" id="project-overview">
            <h2>2. Project Overview</h2>

            <h3>Business Context</h3>
            <p>Construction and infrastructure projects require systematic inspection and quality control processes to ensure compliance with specifications, safety standards, and regulatory requirements. Traditional paper-based inspection processes are prone to errors, delays, and inefficiencies.</p>

            <h3>Solution Approach</h3>
            <p>The WIR Management System digitizes the entire inspection workflow, providing:</p>
            <ul>
                <li>Digital work inspection report creation and management</li>
                <li>Bill of Quantities (BOQ) integration for cost tracking</li>
                <li>Breakdown management for detailed work analysis</li>
                <li>Multi-role user access with appropriate permissions</li>
                <li>Real-time progress tracking and reporting</li>
                <li>Comprehensive audit logging for compliance</li>
                <li>Mobile-responsive design for field use</li>
                <li>Multi-language support (English/Arabic)</li>
            </ul>

            <h3>Target Users</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>User Role</th>
                        <th>Description</th>
                        <th>Key Responsibilities</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Project Managers</td>
                        <td>Overall project oversight</td>
                        <td>Progress monitoring, resource allocation, stakeholder communication</td>
                    </tr>
                    <tr>
                        <td>Site Engineers</td>
                        <td>Field inspection activities</td>
                        <td>WIR creation, quality assessment, technical documentation</td>
                    </tr>
                    <tr>
                        <td>Quality Controllers</td>
                        <td>Quality assurance oversight</td>
                        <td>Inspection validation, compliance verification, report approval</td>
                    </tr>
                    <tr>
                        <td>Contractors</td>
                        <td>Work execution teams</td>
                        <td>Work completion reporting, issue resolution, documentation submission</td>
                    </tr>
                    <tr>
                        <td>Administrators</td>
                        <td>System management</td>
                        <td>User management, system configuration, data maintenance</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" id="system-architecture">
            <h2>3. System Architecture</h2>

            <h3>Architecture Overview</h3>
            <p>The system follows a modern three-tier architecture pattern with clear separation of concerns:</p>

            <div class="workflow">
                <h3>System Architecture Layers</h3>
                <div class="step">
                    <div class="step-number">1</div>
                    <div>
                        <strong>Presentation Layer:</strong> React-based frontend with responsive design, accessible UI components, and real-time updates
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div>
                        <strong>Business Logic Layer:</strong> Custom hooks and services managing application logic, data processing, and business rules
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div>
                        <strong>Data Layer:</strong> Supabase PostgreSQL database with Row Level Security, real-time subscriptions, and file storage
                    </div>
                </div>
            </div>

            <h3>Technology Stack</h3>
            <div class="tech-stack">
                <div class="tech-item">
                    <h4>Frontend Framework</h4>
                    <p>React 18.3.1 with TypeScript</p>
                </div>
                <div class="tech-item">
                    <h4>Build Tool</h4>
                    <p>Vite for fast development and optimized builds</p>
                </div>
                <div class="tech-item">
                    <h4>Styling</h4>
                    <p>Tailwind CSS with custom design system</p>
                </div>
                <div class="tech-item">
                    <h4>UI Components</h4>
                    <p>Shadcn/ui with Radix UI primitives</p>
                </div>
                <div class="tech-item">
                    <h4>Backend Services</h4>
                    <p>Supabase (PostgreSQL, Auth, Storage)</p>
                </div>
                <div class="tech-item">
                    <h4>State Management</h4>
                    <p>React Query for server state, Context for client state</p>
                </div>
                <div class="tech-item">
                    <h4>Form Handling</h4>
                    <p>React Hook Form with Zod validation</p>
                </div>
                <div class="tech-item">
                    <h4>Routing</h4>
                    <p>React Router v6 with protected routes</p>
                </div>
            </div>

            <h3>Key Architectural Decisions</h3>
            <ul>
                <li><strong>Component-Based Architecture:</strong> Modular, reusable components for maintainability</li>
                <li><strong>Custom Hook Pattern:</strong> Business logic encapsulation and reusability</li>
                <li><strong>Row Level Security:</strong> Database-level security for multi-tenant data isolation</li>
                <li><strong>Real-time Subscriptions:</strong> Live updates for collaborative work environments</li>
                <li><strong>Progressive Web App:</strong> Mobile-first responsive design with offline capabilities</li>
            </ul>
        </div>

        <div class="section" id="features">
            <h2>4. Features & Functionality</h2>

            <h3>Core Modules</h3>

            <h4>Work Inspection Reports (WIR) Management</h4>
            <ul>
                <li>Digital WIR creation with structured forms</li>
                <li>Multi-stage approval workflows</li>
                <li>Revision tracking and version control</li>
                <li>Attachment management (images, documents, PDFs)</li>
                <li>Print-ready report generation</li>
                <li>Status tracking (submitted, approved, rejected)</li>
                <li>Integration with BOQ items for cost allocation</li>
            </ul>

            <h4>Bill of Quantities (BOQ) Management</h4>
            <ul>
                <li>Hierarchical BOQ structure with parent-child relationships</li>
                <li>Unit rates and quantity management</li>
                <li>Automatic total amount calculations</li>
                <li>Multi-language descriptions (English/Arabic)</li>
                <li>BOQ item categorization and search</li>
                <li>Progress tracking against BOQ items</li>
            </ul>

            <h4>Breakdown Management</h4>
            <ul>
                <li>Detailed work breakdown structures</li>
                <li>Percentage-based progress tracking</li>
                <li>Value calculations and cost monitoring</li>
                <li>Sub-item management with leaf node identification</li>
                <li>Integration with WIR activities</li>
            </ul>

            <h4>Staff Management</h4>
            <ul>
                <li>Engineer profile management with specializations</li>
                <li>Contractor information and company details</li>
                <li>Role-based access control</li>
                <li>Contact information and department tracking</li>
                <li>Assignment tracking for WIRs</li>
            </ul>

            <h4>Progress Tracking & Reporting</h4>
            <ul>
                <li>Real-time progress calculations</li>
                <li>Visual progress indicators and charts</li>
                <li>Summary reports and dashboards</li>
                <li>Export capabilities (Excel, PDF)</li>
                <li>Filter and search functionalities</li>
                <li>Progress history and trends</li>
            </ul>

            <h4>Audit & Compliance</h4>
            <ul>
                <li>Comprehensive audit logging for all operations</li>
                <li>User activity tracking with timestamps</li>
                <li>Change history and modification trails</li>
                <li>Compliance reporting and documentation</li>
                <li>Security event logging</li>
            </ul>

            <h3>Advanced Features</h3>

            <h4>Accessibility & Internationalization</h4>
            <ul>
                <li>WCAG 2.1 AA compliance with screen reader support</li>
                <li>Keyboard navigation and focus management</li>
                <li>High contrast mode and font size adjustments</li>
                <li>Bilingual support (English/Arabic) with RTL layout</li>
                <li>Accessibility announcements and notifications</li>
            </ul>

            <h4>Mobile & Responsive Design</h4>
            <ul>
                <li>Mobile-first responsive design approach</li>
                <li>Touch-optimized interface for field use</li>
                <li>Progressive Web App capabilities</li>
                <li>Offline functionality for critical operations</li>
                <li>Cross-browser compatibility</li>
            </ul>

            <h4>Performance & Scalability</h4>
            <ul>
                <li>Lazy loading and code splitting</li>
                <li>Optimized database queries with indexing</li>
                <li>Caching strategies for improved performance</li>
                <li>Real-time synchronization without performance impact</li>
                <li>Scalable architecture for growing data volumes</li>
            </ul>
        </div>

        <div class="section" id="technical-specifications">
            <h2>5. Technical Specifications</h2>

            <h3>Frontend Specifications</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Technology</th>
                        <th>Version</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Core Framework</td>
                        <td>React</td>
                        <td>18.3.1</td>
                        <td>Component-based UI development</td>
                    </tr>
                    <tr>
                        <td>Build Tool</td>
                        <td>Vite</td>
                        <td>Latest</td>
                        <td>Fast development server and build optimization</td>
                    </tr>
                    <tr>
                        <td>Type System</td>
                        <td>TypeScript</td>
                        <td>Latest</td>
                        <td>Static typing and enhanced developer experience</td>
                    </tr>
                    <tr>
                        <td>Styling Framework</td>
                        <td>Tailwind CSS</td>
                        <td>Latest</td>
                        <td>Utility-first CSS framework with custom design system</td>
                    </tr>
                    <tr>
                        <td>UI Components</td>
                        <td>Shadcn/ui + Radix UI</td>
                        <td>Latest</td>
                        <td>Accessible, customizable component library</td>
                    </tr>
                    <tr>
                        <td>State Management</td>
                        <td>TanStack Query</td>
                        <td>5.56.2</td>
                        <td>Server state management and caching</td>
                    </tr>
                    <tr>
                        <td>Form Handling</td>
                        <td>React Hook Form</td>
                        <td>7.53.0</td>
                        <td>Performant form validation and submission</td>
                    </tr>
                    <tr>
                        <td>Validation</td>
                        <td>Zod</td>
                        <td>3.23.8</td>
                        <td>Runtime type validation and schema definition</td>
                    </tr>
                </tbody>
            </table>

            <h3>Backend Specifications</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Technology</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Database</td>
                        <td>Supabase PostgreSQL</td>
                        <td>Primary data storage with ACID compliance</td>
                    </tr>
                    <tr>
                        <td>Authentication</td>
                        <td>Supabase Auth</td>
                        <td>User authentication and session management</td>
                    </tr>
                    <tr>
                        <td>File Storage</td>
                        <td>Supabase Storage</td>
                        <td>Secure file upload and management</td>
                    </tr>
                    <tr>
                        <td>Real-time</td>
                        <td>Supabase Realtime</td>
                        <td>Live data synchronization</td>
                    </tr>
                    <tr>
                        <td>API</td>
                        <td>Supabase Auto-generated REST/GraphQL</td>
                        <td>Database API with automatic schema reflection</td>
                    </tr>
                </tbody>
            </table>

            <h3>Performance Metrics</h3>
            <div class="alert alert-info">
                <strong>Performance Targets:</strong>
                <ul>
                    <li>Initial page load: < 3 seconds</li>
                    <li>Navigation between pages: < 1 second</li>
                    <li>Form submission response: < 2 seconds</li>
                    <li>Real-time update latency: < 500ms</li>
                    <li>Lighthouse performance score: > 90</li>
                </ul>
            </div>

            <h3>Browser Support</h3>
            <ul>
                <li>Chrome 88+ (Primary target)</li>
                <li>Firefox 85+ (Full support)</li>
                <li>Safari 14+ (Full support)</li>
                <li>Edge 88+ (Full support)</li>
                <li>Mobile browsers (iOS Safari 14+, Chrome Mobile 88+)</li>
            </ul>
        </div>

        <div class="section" id="database-schema">
            <h2>6. Database Schema</h2>

            <h3>Core Tables</h3>

            <h4>WIRs Table</h4>
            <div class="code-block">
CREATE TABLE public.wirs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    wir_number TEXT NOT NULL,
    description TEXT NOT NULL,
    description_ar TEXT,
    submittal_date DATE NOT NULL,
    received_date DATE,
    status wir_status NOT NULL DEFAULT 'submitted',
    result wir_result,
    boq_item_id UUID NOT NULL,
    value NUMERIC NOT NULL,
    calculated_amount NUMERIC,
    contractor TEXT NOT NULL,
    engineer TEXT NOT NULL,
    line_no TEXT NOT NULL,
    region TEXT NOT NULL,
    length_of_line NUMERIC NOT NULL,
    diameter_of_line NUMERIC NOT NULL,
    -- Additional location fields
    manhole_from TEXT,
    manhole_to TEXT,
    zone TEXT,
    road TEXT,
    line TEXT,
    -- Metadata
    attachments UUID[] DEFAULT '{}',
    linked_boq_items UUID[] DEFAULT '{}',
    selected_breakdown_items UUID[] DEFAULT '{}',
    calculation_equation TEXT,
    status_conditions TEXT,
    -- Revision tracking
    parent_wir_id UUID,
    revision_number INTEGER DEFAULT 0,
    original_wir_id UUID,
    -- Timestamps
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);
            </div>

            <h4>BOQ Items Table</h4>
            <div class="code-block">
CREATE TABLE public.boq_items (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code TEXT NOT NULL,
    description TEXT NOT NULL,
    description_ar TEXT,
    unit TEXT NOT NULL,
    unit_ar TEXT,
    quantity NUMERIC NOT NULL DEFAULT 0,
    unit_rate NUMERIC NOT NULL DEFAULT 0,
    total_amount NUMERIC,
    parent_id UUID REFERENCES boq_items(id),
    level INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);
            </div>

            <h4>Profiles & User Management</h4>
            <div class="code-block">
CREATE TABLE public.profiles (
    id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    username TEXT,
    full_name TEXT,
    role TEXT DEFAULT 'viewer',
    active_role app_role DEFAULT 'viewer',
    department TEXT,
    password TEXT,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE TABLE public.user_roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    role app_role NOT NULL,
    assigned_at TIMESTAMPTZ DEFAULT now(),
    assigned_by UUID REFERENCES auth.users(id),
    is_active BOOLEAN DEFAULT true,
    UNIQUE(user_id, role)
);
            </div>

            <h3>Enums & Custom Types</h3>
            <div class="code-block">
-- Application roles
CREATE TYPE public.app_role AS ENUM ('admin', 'editor', 'viewer', 'data_entry');

-- WIR status tracking
CREATE TYPE public.wir_status AS ENUM ('submitted', 'approved', 'rejected', 'revision_requested');

-- WIR inspection results
CREATE TYPE public.wir_result AS ENUM ('pass', 'fail', 'conditional');
            </div>

            <h3>Security Policies (Row Level Security)</h3>
            <div class="code-block">
-- Example RLS policies for secure multi-tenant access
ALTER TABLE public.wirs ENABLE ROW LEVEL SECURITY;

-- Allow viewing WIRs for authenticated users
CREATE POLICY "Allow viewing WIRs for manual auth" 
ON public.wirs FOR SELECT 
USING (true);

-- Allow modifying WIRs based on role permissions
CREATE POLICY "Allow modifying WIRs for manual auth" 
ON public.wirs FOR ALL 
USING (true) 
WITH CHECK (true);
            </div>

            <h3>Indexes & Performance Optimization</h3>
            <div class="code-block">
-- Performance indexes for common queries
CREATE INDEX idx_wirs_status ON public.wirs(status);
CREATE INDEX idx_wirs_submittal_date ON public.wirs(submittal_date);
CREATE INDEX idx_wirs_boq_item ON public.wirs(boq_item_id);
CREATE INDEX idx_wirs_contractor ON public.wirs(contractor);
CREATE INDEX idx_wirs_engineer ON public.wirs(engineer);
CREATE INDEX idx_boq_items_parent ON public.boq_items(parent_id);
CREATE INDEX idx_boq_items_code ON public.boq_items(code);
            </div>
        </div>

        <div class="section" id="user-management">
            <h2>7. User Management & Security</h2>

            <h3>Role-Based Access Control</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>Permissions</th>
                        <th>Access Level</th>
                        <th>Typical Users</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Admin</strong></td>
                        <td>Full system access, user management, system configuration</td>
                        <td>Read, Write, Delete, Manage</td>
                        <td>System administrators, IT managers</td>
                    </tr>
                    <tr>
                        <td><strong>Editor</strong></td>
                        <td>Create, edit, delete records, approve WIRs</td>
                        <td>Read, Write, Delete</td>
                        <td>Project managers, senior engineers</td>
                    </tr>
                    <tr>
                        <td><strong>Data Entry</strong></td>
                        <td>Create and edit records, submit WIRs</td>
                        <td>Read, Write</td>
                        <td>Site engineers, quality controllers</td>
                    </tr>
                    <tr>
                        <td><strong>Viewer</strong></td>
                        <td>Read-only access to assigned data</td>
                        <td>Read</td>
                        <td>Contractors, consultants, stakeholders</td>
                    </tr>
                </tbody>
            </table>

            <h3>Authentication Flow</h3>
            <div class="workflow">
                <h3>User Authentication Process</h3>
                <div class="step">
                    <div class="step-number">1</div>
                    <div>User enters credentials (username/password) on login form</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div>System validates credentials against profiles table</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div>Upon successful validation, user session is created</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div>User roles are fetched and active role is determined</div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div>Route access is controlled based on role permissions</div>
                </div>
            </div>

            <h3>Security Measures</h3>
            <ul>
                <li><strong>Row Level Security (RLS):</strong> Database-level access control</li>
                <li><strong>Password Security:</strong> Encrypted password storage</li>
                <li><strong>Session Management:</strong> Secure session handling with automatic timeout</li>
                <li><strong>Input Validation:</strong> Comprehensive client and server-side validation</li>
                <li><strong>SQL Injection Prevention:</strong> Parameterized queries and ORM protection</li>
                <li><strong>XSS Protection:</strong> Input sanitization and content security policies</li>
                <li><strong>HTTPS Enforcement:</strong> Encrypted data transmission</li>
                <li><strong>Audit Logging:</strong> Complete activity tracking for security monitoring</li>
            </ul>

            <h3>Data Privacy & Compliance</h3>
            <div class="alert">
                <strong>Privacy Considerations:</strong>
                <ul>
                    <li>Personal data is encrypted at rest and in transit</li>
                    <li>User access is logged and monitored</li>
                    <li>Data retention policies are enforced</li>
                    <li>Users can request data export or deletion</li>
                    <li>Regular security audits and penetration testing</li>
                </ul>
            </div>
        </div>

        <div class="section" id="installation">
            <h2>8. Installation & Setup</h2>

            <h3>Development Environment Setup</h3>
            
            <h4>Prerequisites</h4>
            <ul>
                <li>Node.js 18.0 or higher</li>
                <li>npm or yarn package manager</li>
                <li>Git version control</li>
                <li>Modern web browser (Chrome, Firefox, Safari, Edge)</li>
                <li>Code editor (VS Code recommended)</li>
            </ul>

            <h4>Installation Steps</h4>
            <div class="code-block">
# 1. Clone the repository
git clone [repository-url]
cd wir-management-system

# 2. Install dependencies
npm install

# 3. Set up environment variables
cp .env.example .env.local
# Edit .env.local with your Supabase credentials

# 4. Start development server
npm run dev

# 5. Open browser to http://localhost:5173
            </div>

            <h3>Supabase Configuration</h3>
            <div class="code-block">
# Environment Variables (.env.local)
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key
            </div>

            <h4>Database Setup</h4>
            <ol>
                <li>Create new Supabase project</li>
                <li>Run database migrations from <code>/supabase/migrations</code></li>
                <li>Set up Row Level Security policies</li>
                <li>Configure storage buckets for file uploads</li>
                <li>Set up database functions and triggers</li>
            </ol>

            <h3>Production Deployment</h3>
            
            <h4>Build Process</h4>
            <div class="code-block">
# Create production build
npm run build

# Preview production build locally
npm run preview

# Deploy to hosting platform
# (Vercel, Netlify, or custom server)
            </div>

            <h4>Environment Configuration</h4>
            <ul>
                <li>Configure production Supabase instance</li>
                <li>Set up SSL certificates</li>
                <li>Configure domain and DNS</li>
                <li>Set up monitoring and logging</li>
                <li>Configure backup procedures</li>
            </ul>

            <div class="alert alert-info">
                <strong>Deployment Checklist:</strong>
                <ul>
                    <li>✓ Environment variables configured</li>
                    <li>✓ Database migrations applied</li>
                    <li>✓ SSL certificate installed</li>
                    <li>✓ Performance optimization enabled</li>
                    <li>✓ Monitoring and logging configured</li>
                    <li>✓ Backup procedures tested</li>
                </ul>
            </div>
        </div>

        <div class="section" id="user-guides">
            <h2>9. User Guides</h2>

            <h3>Getting Started</h3>
            <h4>First Login</h4>
            <ol>
                <li>Navigate to the system URL</li>
                <li>Enter your username and password</li>
                <li>Click "Sign In" to access the system</li>
                <li>Complete profile setup if prompted</li>
                <li>Familiarize yourself with the dashboard</li>
            </ol>

            <h3>WIR Management Workflow</h3>
            <div class="workflow">
                <h3>Creating a Work Inspection Report</h3>
                <div class="step">
                    <div class="step-number">1</div>
                    <div>Navigate to WIRs section and click "Add New WIR"</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div>Fill in basic information (WIR number, description, dates)</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div>Select associated BOQ items and breakdown components</div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div>Enter location details and measurement data</div>
                </div>
                <div class="step">
                    <div class="step-number">5</div>
                    <div>Upload attachments (photos, documents, certificates)</div>
                </div>
                <div class="step">
                    <div class="step-number">6</div>
                    <div>Review and submit for approval</div>
                </div>
            </div>

            <h3>Common Tasks by Role</h3>

            <h4>For Site Engineers</h4>
            <ul>
                <li>Create new WIRs for completed work items</li>
                <li>Upload inspection photos and documentation</li>
                <li>Update WIR status based on inspection results</li>
                <li>Track progress against assigned BOQ items</li>
                <li>Generate inspection reports for stakeholders</li>
            </ul>

            <h4>For Project Managers</h4>
            <ul>
                <li>Monitor overall project progress</li>
                <li>Review and approve submitted WIRs</li>
                <li>Generate progress reports and summaries</li>
                <li>Manage staff assignments and permissions</li>
                <li>Track costs and budget allocation</li>
            </ul>

            <h4>For Quality Controllers</h4>
            <ul>
                <li>Review WIRs for compliance and accuracy</li>
                <li>Request revisions for incomplete reports</li>
                <li>Approve or reject inspection reports</li>
                <li>Generate compliance documentation</li>
                <li>Monitor quality metrics and trends</li>
            </ul>

            <h3>Advanced Features</h3>

            <h4>Bulk Operations</h4>
            <ul>
                <li>Bulk WIR creation from BOQ templates</li>
                <li>Mass status updates for multiple WIRs</li>
                <li>Batch file uploads and processing</li>
                <li>Bulk data export for external reporting</li>
            </ul>

            <h4>Reporting & Analytics</h4>
            <ul>
                <li>Progress dashboard with visual indicators</li>
                <li>Custom report generation with filters</li>
                <li>Export capabilities (Excel, PDF, CSV)</li>
                <li>Trend analysis and performance metrics</li>
            </ul>
        </div>

        <div class="section" id="api-documentation">
            <h2>10. API Documentation</h2>

            <h3>API Architecture</h3>
            <p>The system uses Supabase's auto-generated REST API with custom business logic implemented through database functions and client-side services.</p>

            <h3>Authentication</h3>
            <div class="code-block">
// Authentication headers required for all API calls
Authorization: Bearer [JWT_TOKEN]
apikey: [SUPABASE_ANON_KEY]
Content-Type: application/json
            </div>

            <h3>Core Endpoints</h3>

            <h4>WIRs Management</h4>
            <div class="code-block">
// Get all WIRs with filters
GET /rest/v1/wirs?select=*&status=eq.submitted

// Create new WIR
POST /rest/v1/wirs
{
  "wir_number": "WIR-2025-001",
  "description": "Pipe installation inspection",
  "boq_item_id": "uuid",
  "contractor": "ABC Contractors",
  "engineer": "John Smith"
}

// Update WIR
PATCH /rest/v1/wirs?id=eq.[uuid]
{
  "status": "approved",
  "result": "pass"
}

// Delete WIR
DELETE /rest/v1/wirs?id=eq.[uuid]
            </div>

            <h4>BOQ Items</h4>
            <div class="code-block">
// Get BOQ hierarchy
GET /rest/v1/boq_items?select=*,children:boq_items!parent_id(*)

// Create BOQ item
POST /rest/v1/boq_items
{
  "code": "01.02.03",
  "description": "Excavation work",
  "unit": "m3",
  "quantity": 100,
  "unit_rate": 25.50
}
            </div>

            <h4>Progress Tracking</h4>
            <div class="code-block">
// Get progress summary
GET /rest/v1/rpc/get_progress_summary

// Calculate BOQ progress
GET /rest/v1/rpc/calculate_boq_progress?boq_item_id=[uuid]
            </div>

            <h3>Custom Database Functions</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Function</th>
                        <th>Purpose</th>
                        <th>Parameters</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>get_current_user_role()</td>
                        <td>Get active role for authenticated user</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td>has_role(user_id, role)</td>
                        <td>Check if user has specific role</td>
                        <td>UUID, app_role</td>
                    </tr>
                    <tr>
                        <td>switch_user_role(role)</td>
                        <td>Switch user's active role</td>
                        <td>app_role</td>
                    </tr>
                    <tr>
                        <td>get_user_roles(user_id)</td>
                        <td>Get all roles for user</td>
                        <td>UUID</td>
                    </tr>
                </tbody>
            </table>

            <h3>Real-time Subscriptions</h3>
            <div class="code-block">
// Subscribe to WIR changes
const subscription = supabase
  .channel('wirs_changes')
  .on('postgres_changes', {
    event: '*',
    schema: 'public',
    table: 'wirs'
  }, (payload) => {
    console.log('WIR changed:', payload);
  })
  .subscribe();
            </div>

            <h3>Error Handling</h3>
            <div class="code-block">
// Standard error response format
{
  "error": {
    "code": "400",
    "message": "Invalid request parameters",
    "details": "WIR number already exists"
  }
}
            </div>
        </div>

        <div class="section" id="security">
            <h2>11. Security Considerations</h2>

            <h3>Security Architecture</h3>
            <p>The system implements a multi-layered security approach with defense in depth principles:</p>

            <h4>Application Layer Security</h4>
            <ul>
                <li><strong>Input Validation:</strong> Comprehensive validation using Zod schemas</li>
                <li><strong>XSS Prevention:</strong> React's built-in XSS protection and content sanitization</li>
                <li><strong>CSRF Protection:</strong> Token-based request validation</li>
                <li><strong>Authentication:</strong> JWT-based stateless authentication</li>
                <li><strong>Authorization:</strong> Role-based access control with route protection</li>
            </ul>

            <h4>Database Security</h4>
            <ul>
                <li><strong>Row Level Security (RLS):</strong> Fine-grained data access control</li>
                <li><strong>SQL Injection Prevention:</strong> Parameterized queries and ORM protection</li>
                <li><strong>Encrypted Storage:</strong> Data encryption at rest</li>
                <li><strong>Audit Logging:</strong> Comprehensive activity tracking</li>
                <li><strong>Backup Security:</strong> Encrypted backups with access controls</li>
            </ul>

            <h4>Infrastructure Security</h4>
            <ul>
                <li><strong>HTTPS Enforcement:</strong> TLS 1.3 encryption for data in transit</li>
                <li><strong>Network Security:</strong> Firewall rules and VPC isolation</li>
                <li><strong>Rate Limiting:</strong> Protection against DDoS and abuse</li>
                <li><strong>Security Headers:</strong> HSTS, CSP, and other security headers</li>
                <li><strong>Regular Updates:</strong> Automated security patches and updates</li>
            </ul>

            <h3>Compliance & Standards</h3>
            <div class="alert">
                <strong>Security Compliance:</strong>
                <ul>
                    <li>OWASP Top 10 security guidelines</li>
                    <li>GDPR compliance for data protection</li>
                    <li>ISO 27001 security management practices</li>
                    <li>Regular security audits and penetration testing</li>
                    <li>Incident response procedures</li>
                </ul>
            </div>

            <h3>Security Monitoring</h3>
            <ul>
                <li>Real-time security event monitoring</li>
                <li>Automated threat detection and response</li>
                <li>Regular vulnerability assessments</li>
                <li>Security metrics and reporting</li>
                <li>Incident tracking and response procedures</li>
            </ul>

            <h3>User Security Best Practices</h3>
            <ul>
                <li>Strong password requirements and policies</li>
                <li>Regular password rotation recommendations</li>
                <li>Multi-factor authentication (where applicable)</li>
                <li>User security training and awareness</li>
                <li>Secure session management and timeout</li>
            </ul>
        </div>

        <div class="section" id="maintenance">
            <h2>12. Maintenance & Support</h2>

            <h3>System Maintenance</h3>

            <h4>Regular Maintenance Tasks</h4>
            <ul>
                <li><strong>Database Maintenance:</strong> Regular backups, index optimization, query performance analysis</li>
                <li><strong>Security Updates:</strong> Apply security patches and updates promptly</li>
                <li><strong>Performance Monitoring:</strong> Track system performance metrics and optimize as needed</li>
                <li><strong>Backup Verification:</strong> Regular testing of backup and restore procedures</li>
                <li><strong>Log Management:</strong> Archive and analyze system logs for issues and trends</li>
            </ul>

            <h4>Monitoring & Alerting</h4>
            <ul>
                <li>Application performance monitoring (APM)</li>
                <li>Database performance and health monitoring</li>
                <li>Security event monitoring and alerting</li>
                <li>User activity and usage analytics</li>
                <li>System resource utilization tracking</li>
            </ul>

            <h3>Support Procedures</h3>

            <h4>Issue Classification</h4>
            <table class="table">
                <thead>
                    <tr>
                        <th>Priority</th>
                        <th>Description</th>
                        <th>Response Time</th>
                        <th>Resolution Target</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Critical</strong></td>
                        <td>System down, data loss, security breach</td>
                        <td>1 hour</td>
                        <td>4 hours</td>
                    </tr>
                    <tr>
                        <td><strong>High</strong></td>
                        <td>Major feature broken, performance issues</td>
                        <td>4 hours</td>
                        <td>24 hours</td>
                    </tr>
                    <tr>
                        <td><strong>Medium</strong></td>
                        <td>Minor feature issues, usability problems</td>
                        <td>24 hours</td>
                        <td>72 hours</td>
                    </tr>
                    <tr>
                        <td><strong>Low</strong></td>
                        <td>Enhancement requests, documentation</td>
                        <td>48 hours</td>
                        <td>1 week</td>
                    </tr>
                </tbody>
            </table>

            <h4>Escalation Procedures</h4>
            <ol>
                <li><strong>Level 1:</strong> Front-line support team</li>
                <li><strong>Level 2:</strong> Technical specialists and developers</li>
                <li><strong>Level 3:</strong> Senior architects and external vendors</li>
                <li><strong>Management:</strong> Critical issues affecting business operations</li>
            </ol>

            <h3>Backup & Recovery</h3>

            <h4>Backup Strategy</h4>
            <ul>
                <li><strong>Daily Backups:</strong> Automated daily database backups</li>
                <li><strong>Weekly Backups:</strong> Full system backups including files and configurations</li>
                <li><strong>Real-time Replication:</strong> Continuous data replication for high availability</li>
                <li><strong>Offsite Storage:</strong> Encrypted backups stored in multiple geographic locations</li>
                <li><strong>Retention Policy:</strong> 30 days daily, 12 months weekly, 7 years annual</li>
            </ul>

            <h4>Disaster Recovery</h4>
            <ul>
                <li><strong>Recovery Time Objective (RTO):</strong> 4 hours</li>
                <li><strong>Recovery Point Objective (RPO):</strong> 1 hour</li>
                <li><strong>Failover Procedures:</strong> Documented and tested failover processes</li>
                <li><strong>Communication Plan:</strong> Stakeholder notification procedures</li>
                <li><strong>Testing Schedule:</strong> Quarterly disaster recovery testing</li>
            </ul>

            <h3>System Updates & Upgrades</h3>

            <h4>Update Process</h4>
            <ol>
                <li>Development and testing in staging environment</li>
                <li>User acceptance testing with key stakeholders</li>
                <li>Scheduled maintenance window communication</li>
                <li>Backup verification before deployment</li>
                <li>Production deployment with rollback plan</li>
                <li>Post-deployment validation and monitoring</li>
            </ol>

            <div class="alert alert-success">
                <strong>Maintenance Schedule:</strong>
                <ul>
                    <li>Regular updates: Monthly (non-breaking changes)</li>
                    <li>Major upgrades: Quarterly (with advance notice)</li>
                    <li>Security patches: As needed (emergency deployment)</li>
                    <li>Maintenance window: Sundays 2:00-6:00 AM (local time)</li>
                </ul>
            </div>
        </div>

        <div class="section" id="appendices">
            <h2>13. Appendices</h2>

            <h3>Appendix A: Glossary</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Term</th>
                        <th>Definition</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>BOQ</td>
                        <td>Bill of Quantities - A detailed list of materials, parts, and labor required for a construction project</td>
                    </tr>
                    <tr>
                        <td>WIR</td>
                        <td>Work Inspection Report - A document recording the inspection results of completed construction work</td>
                    </tr>
                    <tr>
                        <td>RLS</td>
                        <td>Row Level Security - Database security feature that controls access to individual rows in database tables</td>
                    </tr>
                    <tr>
                        <td>SPA</td>
                        <td>Single Page Application - A web application that loads a single HTML page and updates content dynamically</td>
                    </tr>
                    <tr>
                        <td>PWA</td>
                        <td>Progressive Web App - A web application that uses modern web capabilities to provide app-like experiences</td>
                    </tr>
                </tbody>
            </table>

            <h3>Appendix B: System Requirements</h3>
            <h4>Minimum System Requirements</h4>
            <ul>
                <li><strong>Processor:</strong> Dual-core 2.0 GHz or higher</li>
                <li><strong>Memory:</strong> 4 GB RAM minimum, 8 GB recommended</li>
                <li><strong>Storage:</strong> 1 GB available space for local cache</li>
                <li><strong>Network:</strong> Stable internet connection (minimum 1 Mbps)</li>
                <li><strong>Display:</strong> 1024x768 minimum resolution, 1920x1080 recommended</li>
            </ul>

            <h3>Appendix C: Contact Information</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Role</th>
                        <th>Contact</th>
                        <th>Responsibility</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Project Manager</td>
                        <td>pm@company.com</td>
                        <td>Overall project coordination and stakeholder communication</td>
                    </tr>
                    <tr>
                        <td>Technical Lead</td>
                        <td>tech@company.com</td>
                        <td>Technical architecture and development oversight</td>
                    </tr>
                    <tr>
                        <td>System Administrator</td>
                        <td>admin@company.com</td>
                        <td>System maintenance and infrastructure management</td>
                    </tr>
                    <tr>
                        <td>Support Team</td>
                        <td>support@company.com</td>
                        <td>User support and issue resolution</td>
                    </tr>
                </tbody>
            </table>

            <h3>Appendix D: Change Log</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Version</th>
                        <th>Date</th>
                        <th>Changes</th>
                        <th>Author</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1.0</td>
                        <td>January 2025</td>
                        <td>Initial system development and deployment</td>
                        <td>Development Team</td>
                    </tr>
                    <tr>
                        <td>1.1</td>
                        <td>TBD</td>
                        <td>Enhanced reporting features and mobile optimization</td>
                        <td>Development Team</td>
                    </tr>
                </tbody>
            </table>

            <div class="alert alert-info">
                <strong>Document Information:</strong><br>
                <strong>Document Version:</strong> 1.0<br>
                <strong>Last Updated:</strong> January 2025<br>
                <strong>Next Review:</strong> April 2025<br>
                <strong>Distribution:</strong> Project stakeholders, development team, system administrators
            </div>
        </div>

        <div style="text-align: center; margin-top: 50px; padding-top: 30px; border-top: 2px solid #e9ecef; color: #666;">
            <p><strong>WIR Management System - Professional Documentation</strong></p>
            <p>© 2025 - All Rights Reserved | Generated on January 2025</p>
        </div>
    </div>

    <script>
        // Add smooth scrolling for table of contents links
        document.querySelectorAll('.toc a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Print functionality
        function printDocument() {
            window.print();
        }

        // Add print button
        const header = document.querySelector('.header');
        const printButton = document.createElement('button');
        printButton.innerHTML = 'Print Documentation';
        printButton.style.cssText = 'background: #0066cc; color: white; border: none; padding: 10px 20px; border-radius: 4px; margin-top: 20px; cursor: pointer;';
        printButton.onclick = printDocument;
        header.appendChild(printButton);
    </script>
</body>
</html>